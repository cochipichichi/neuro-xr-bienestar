<!doctype html>
<html lang="es" data-theme="dark">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>🧠 Neuro-XR — Portal</title>
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" href="assets/icon-192.png">
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header class="header" role="banner">
  <div class="brand"><span class="logo" aria-hidden="true"></span><strong>Neuro‑XR</strong><span class="badge">v1.3</span></div>
  <nav aria-label="Navegación">
    <a class="btn" href="apps/vr/index.html">🕶️ VR</a>
    <a class="btn" href="apps/ar/index.html">📱 AR</a>
    <a class="btn" href="apps/teacher/index.html">👩‍🏫 Docente</a>
    <a class="btn" href="apps/editor/index.html">🧩 Editor</a>
    <a class="btn" href="apps/packs/index.html">📦 Packs</a>
  </nav>
</header>
<main class="container">
  <section class="grid cards">
    <article class="card">
      <h3>Temas</h3>
      <p class="meta">Mar · Bosque · Noche</p>
      <div>
        <button class="btn" data-theme="mar">🌊 Mar</button>
        <button class="btn" data-theme="bosque">🌲 Bosque</button>
        <button class="btn" data-theme="noche">🌌 Noche</button>
      </div>
    </article>
    <article class="card">
      <h3>Playlists</h3>
      <p class="meta">Secuencias de 5–10 min</p>
      <div id="playlists"></div>
    </article>
    <article class="card">
      <h3>BLE opcional</h3>
      <p class="meta">Conectar frecuencia cardíaca</p>
      <button class="btn" id="ble">❤️ Conectar</button>
      <div id="hr" class="meta">—</div>
    </article>
  </section>
</main>
<script type="module">
import * as Th from './js/themes.js';
import * as PL from './js/playlists.js';
import { haptic } from './js/ui.js';
import { connectHR, onHR } from './js/ble.js';

await Th.initTheme();
document.querySelectorAll('[data-theme]').forEach(b=>b.addEventListener('click', async ()=>{ await Th.applyTheme(b.dataset.theme); haptic(); }));

// Playlists render
const list = await PL.listPlaylists();
const cont = document.getElementById('playlists');
cont.innerHTML = list.map(p=>{ const q = PL.toURLParams(p); return `<div class="card" style="background:#ffffff08;margin-top:8px"><strong>${p.name}</strong><br><span class="meta">${(p.phases||[]).map(x=>x.label).join(' · ')}</span><br><a class="btn solid" href="apps/vr/index.html?${q}">▶ VR</a> <a class="btn" href="apps/ar/index.html?${q}">▶ AR</a></div>`; }).join('');

// BLE
document.getElementById('ble').addEventListener('click', async ()=>{
  try{
    const { char } = await connectHR();
    onHR(char, (hr)=> document.getElementById('hr').textContent = `FC: ${hr} bpm`);
  }catch{ document.getElementById('hr').textContent = 'No disponible'; }
});

if('serviceWorker' in navigator && location.protocol==='https:'){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
</script>
</body>
</html>
